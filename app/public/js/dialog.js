
window.QZFL=window.QZFL||{};QZFL.dialog=QZFL.dialog||{count:0,instances:{}};QZFL.dialog.base=function(opts){var _s=QZFL.dialog;this.opts=opts;this.id='qzDialog'+(++_s.count);_s.instances[this.id]=this;};QZFL.dialog.base.prototype.init=function(opts){var _s=QZFL.dialog,dv,l,t,buff,tmp,n=_s.count;opts=opts||this.opts;opts.buttonConfig=opts.buttonConfig||[];opts.hasFooter=(opts.statusContent||opts.buttonConfig.length);opts.zIndex&&(this.zIndex=opts.zIndex);!this.zIndex&&(this.zIndex=6000+n);dv=document.createElement('div');dv.className='qz_dialog_layer';opts&&opts.noShadow&&(dv.className="qz_dialog_layer qz_dialog_layer_no_border");t=opts.top||Math.round(Math.max((QZFL.dom.getClientHeight()-opts.height)/2+QZFL.dom.getScrollTop(),1));l=opts.left||Math.round(Math.max((QZFL.dom.getClientWidth()-opts.width)/2+QZFL.dom.getScrollLeft(),1));dv.style.cssText='z-index:'+this.zIndex+';position:absolute;top:'+t+'px;left:'+l+'px;'+(opts.width?('width:'+parseInt(opts.width,10)+'px;'):'');dv.setAttribute('tabIndex',-1);dv.setAttribute('role','dialog');dv.id='qz_dialog_instance_'+this.id;this.uniqueID=n;this.mainId="dialog_main_"+n;this.headId="dialog_head_"+n;this.titleId="dialog_title_"+n;this.closeId="dialog_button_"+n;this.contentId="dialog_content_"+n;this.frameId="dialog_frame_"+n;this.titleBarHeight=opts.noBorder?0:30;dv.setAttribute('aria-labelledby',this.headId);dv.setAttribute('aria-describedby',this.contentId);buff=[];buff.push('<div id="',this.mainId,'" class="qz_dialog_layer_main',opts.hasFooter?' qz_dialog_btn_bpadding':'','"',(opts.noBorder?' style="border-width:0;padding:0;margin:0;background-color:transparent;"':''),'>',opts.noCustom?'':'<div class="qz_dialog_custom custom_left"></div><div class="qz_dialog_custom custom_top"></div>','<div id="',this.headId,'" class="qz_dialog_layer_title"',(opts.noBorder?' style="display:none;"':''),'><h3 id="',this.titleId,'">',opts.title,'</h3><button id="',this.closeId,'" title="关闭" class="qz_dialog_btn_close',opts.noCloseButton?" none":"",'"><span class="none">&#9587;</span></button></div>','<div id="',this.contentId,'" class="qz_dialog_layer_cont" style="height:',parseInt(opts.height,10),'px;',(opts.noBorder?'background-color:transparent;':''),'">',QZFL.dialog.base.genContent(opts.content),'</div>');if(opts.hasFooter){buff.push('<div class="qz_dialog_layer_ft">','<div class="qz_dialog_layer_other">',opts.statusContent||'','</div>','<div class="qz_dialog_layer_op">');for(var i=0,len=opts.buttonConfig.length;i<len;++i){tmp=opts.buttonConfig[i];tmp.type=tmp.type||_s.BUTTON_TYPE.Normal;tmp.text=tmp.text||'按钮';tmp.tips=tmp.tips||('点击这里'+tmp.text);if(tmp.type<_s.BUTTON_TYPE.Normal){buff.push('<span title="',tmp.tips,'" class="qz_dialog_layer_btn qz_dialog_layer_disabled"><span>',tmp.text,'</span></span>');}else{buff.push('<a href="javascript:;" title="',tmp.tips,'" class="qz_dialog_layer_btn qz_dialog_layer_',(tmp.type==_s.BUTTON_TYPE.Confirm?'sub':'nor'),'"><span>',tmp.text,'</span></a>');}}
buff.push('</div></div>');}
buff.push('</div>');if(opts.noIframeMask){}else{if(ua.ie){buff.push('<iframe id="',this.frameId,'" class="qz_dialog_layer_mask" frameBorder="no" style="opacity:0;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);position:absolute;top:0;left:0;z-index:-1;" width="',(ua.ie==6)?((parseInt(opts.width,10))+'px'):'100%','" height="',(ua.ie==6)?((parseInt(opts.height,10)+this.titleBarHeight)+'px'):'100%','"></iframe>');}}
dv.innerHTML=buff.join('');document.body.appendChild(dv);this.dialogBody=dv;this.dialogTitle=QZFL.element.get('.qz_dialog_layer_title',dv).eq(0);this.dialogContent=QZFL.element.get('.qz_dialog_layer_cont',dv).eq(0);this.dialogFooter=QZFL.element.get('.qz_dialog_layer_ft',dv).eq(0);this.dialogDressLeft=QZFL.element.get('.custom_left',dv).eq(0);this.dialogDressTop=QZFL.element.get('.custom_top',dv).eq(0);this.dialogMask=QZFL.element.get('.qz_dialog_layer_mask',dv).eq(0);QZFL.element.get('.qz_dialog_btn_close',this.dialogBody).bind("click",QZFL.dialog.base.close,this.id);QZFL.event.addEvent(this.dialogBody,'click',QZFL.dialog.base.clickFocus,[this.id]);QZFL.event.addEvent(QZFL.element.get('.qz_dialog_layer_op',this.dialogFooter).eq(0),'click',QZFL.dialog.base.clickOpr,[this.id]);if(QZFL.dragdrop&&QZFL.dragdrop.registerDragdropHandler){QZFL.dragdrop.registerDragdropHandler(this.dialogTitle,dv);QZFL.dragdrop.registerDragdropHandler(this.dialogDressLeft,dv);QZFL.dragdrop.registerDragdropHandler(this.dialogDressTop,dv);}
this.focus();opts.showMask&&QZFL.maskLayout&&QZFL.maskLayout.create(this.zIndex-1);(typeof opts.onLoad=='function')&&((this.onLoad=opts.onLoad)(this));};QZFL.dialog.base.prototype.fillTitle=function(html){this.dialogTitle&&QZFL.element.get('h3',this.dialogTitle).setHtml(html);};QZFL.dialog.base.frameTemplate='<iframe width="100%" height="100%" src="{src}" allowtransparency="yes" frameborder="no" scrolling="no"></iframe>';QZFL.dialog.base.genContent=function(c){(c&&typeof(c)=='object')&&(c=QZFL.string.format(QZFL.dialog.base.frameTemplate,c));return c;};QZFL.dialog.base.prototype.fillContent=function(html,onAfterFill){this.dialogContent&&(this.dialogContent.innerHTML=QZFL.dialog.base.genContent(html));(typeof onAfterFill=='function')&&(onAfterFill(this.dialogBody));};QZFL.dialog.base.prototype.hide=function(){this.dialogBody&&(this.dialogBody.style.display='none');this.blur();};QZFL.dialog.base.prototype.show=function(){this.dialogBody&&(this.dialogBody.style.display='');this.focus();};QZFL.dialog.base.close=function(evt,sid){var _s=QZFL.dialog,t=_s.instances[sid];t&&t.unload();};QZFL.dialog.base.clickFocus=function(evt,sid){var _s=QZFL.dialog,t=_s.instances[sid];t&&t.focus();};QZFL.dialog.base.clickOpr=function(evt,sid){!evt&&(evt=QZFL.event.getEvent(evt));var _s=QZFL.dialog,ins=_s.instances[sid],t=QZFL.event.getTarget(evt),l=QZFL.element.get('.qz_dialog_layer_btn',ins.dialogFooter),idx=-1,tmp;l.each(function(obj,itr){if(obj==t||QZFL.dom.contains(obj,t)){idx=itr;}});if(idx>-1&&ins){if(tmp=ins.opts.buttonConfig[idx]){(typeof tmp.clickFn=='function')&&tmp.clickFn();if(tmp.type>_s.BUTTON_TYPE.Normal){if(tmp.type==_s.BUTTON_TYPE.Cancel){(typeof ins.onCancel=='function')&&ins.onCancel();}else if(tmp.type==_s.BUTTON_TYPE.Confirm){(typeof ins.onConfirm=='function')&&ins.onConfirm();}else if(tmp.type==_s.BUTTON_TYPE.Negative){(typeof ins.onNegative=='function')&&ins.onNegative();(typeof ins.onNo=='function')&&ins.onNo();}
if(!tmp.preventDefault){ins.unload();}}}}
QZFL.event.preventDefault(evt);};QZFL.dialog.base.computePosition=function(w,h,opts){var l,t;t=opts&&opts.top||Math.round(Math.max((QZFL.dom.getClientHeight()-h)/2+QZFL.dom.getScrollTop(),1));l=opts&&opts.left||Math.round(Math.max((QZFL.dom.getClientWidth()-w)/2+QZFL.dom.getScrollLeft(),1));return[l,t];};QZFL.dialog.base.prototype.unload=function(){var _s=QZFL.dialog;this.onBeforeUnload=this.onBeforeUnload||this.opts.onBeforeUnload;if((typeof(this.onBeforeUnload)!='function')||this.onBeforeUnload(this.returnValue)){this.blur();QZFL.dragdrop&&QZFL.dragdrop.registerDragdropHandler&&QZFL.dragdrop.unRegisterDragdropHandler(this.dialogTitle);QZFL.event.removeEvent(this.dialogBody,'click',QZFL.dialog.base.clickFocus);if(QZFL.userAgent.ie===8&&this.dialogBody){this.dialogBody.style.display='none';}
(typeof(this.onUnload)=='function')&&this.onUnload(this.returnValue);if(this.dialogBody&&this.dialogBody.getElementsByTagName("iframe").length){var iframes=this.dialogBody.getElementsByTagName("iframe");for(var i=0;i<iframes.length;i++){iframes[i]&&QZFL.dom.removeElement(iframes[i]);}}
QZFL.dom.removeElement(this.dialogBody);this.onUnload=this.onBeforeUnload=this.onLoad=this.onConfirm=this.onNegative=this.onNo=this.onCancel=this.returnValue=this.dialogTitle=this.dialogContent=this.dialogFooter=this.dialogBody=null;this.opts.showMask&&QZFL.maskLayout&&QZFL.maskLayout.remove();delete _s.instances[this.id];}};QZFL.dialog.base.prototype.setReturnValue=function(v){(typeof v!='undefined')&&(this.returnValue=v);};QZFL.dialog.base.prototype.focus=function(){var _s=QZFL.dialog;if(!this.isCurrent&&this.dialogBody){_s.current&&_s.current.blur();this.dialogBody.style.zIndex=parseInt(this.zIndex)+3000;this.isCurrent=true;_s.current=this;try{this.dialogBody.focus();}catch(e){}}};QZFL.dialog.base.prototype.blur=function(){var _s=QZFL.dialog;if(this.isCurrent&&this.dialogBody){(_s.current===this)&&(_s.current=null);this.dialogBody.style.zIndex=parseInt(this.zIndex);this.isCurrent=false;}};QZFL.dialog.base.prototype.getZIndex=function(){return parseInt(this.dialogBody.style.zIndex,10);};QZFL.dialog.base.prototype.setSize=function(w,h){var p,t;w=parseInt(w,10);h=parseInt(h,10);w&&(this.dialogBody.style.width=w+'px');h&&(this.dialogContent.style.height=h+'px');if(this.dialogMask){w&&(this.dialogMask.style.width=w+'px');h&&(this.dialogMask.style.height=(h+this.titleBarHeight)+'px');}
if(this.opts.top||this.opts.left){}else{p=QZFL.dialog.base.computePosition(w,h,this.opts);(t=this.dialogBody).style.left=p[0]+'px';t.style.top=p[1]+'px';}};QZFL.dialog.getById=function(s){var n,_s=QZFL.dialog;if(!s){return _s.getCurrentDialog();}
s=String(s);n=parseInt(s,10);(!isNaN(n))&&(s='qzDialog'+s);return _s.instances[s];};QZFL.dialog.getCurrentDialog=function(){return QZFL.dialog.current;};QZFL.dialog.shell=QZFL.dialog.base;/*  |xGv00|47e21b7b3f56d2771404c0ab655b4822 */